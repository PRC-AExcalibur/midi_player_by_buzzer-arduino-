int play = 2;//port 2 is switch,on/palse  端口2开关, 开始/暂停
int buzzer = 3;//port 3 is buzzer,端口3蜂鸣器
int play_state = 0;
//music array, 音乐数组放在下面
const int sakura[] = {270,784,880,587,523,587,523,784,880,587,523,587,523,784,880,587,523,587,523,698,659,698,659,587,523,784,880,587,523,587,523,784,880,587,523,587,523,784,880,1047,1397,1319,1397,1319,1175,1047,880,784,880,587,523,587,523,784,880,587,523,587,523,784,880,587,523,587,523,698,659,698,659,587,523,784,880,1047,1175,1047,880,784,587,698,784,880,587,587,523,587,294,294,262,294,349,349,392,294,294,262,294,262,220,262,294,294,262,294,349,392,440,440,392,440,392,349,294,294,294,262,294,349,349,392,294,294,262,294,262,262,220,294,294,262,262,294,349,392,440,392,440,392,349,294,349,330,294,262,262,262,294,220,196,220,220,262,294,392,330,349,330,262,294,349,330,294,262,262,262,294,220,196,220,220,262,294,294,294,349,392,330,294,349,392,392,440,440,440,523,587,392,349,440,294,349,392,392,440,440,440,466,440,392,349,349,294,349,392,392,440,440,440,523,587,392,349,440,294,349,466,440,392,349,392,440,330,262,294,294,349,392,392,440,440,440,523,587,392,349,440,294,349,392,392,440,440,440,466,440,392,349,349,294,349,392,392,440,440,440,523,587,392,349,440,294,349,466,440,392,349,392,349,440,523,587,216,216,108,108,108,108,216,216,108,108,108,108,216,216,108,108,108,108,216,80,80,80,216,216,216,216,108,108,108,108,216,216,108,108,108,108,216,216,216,216,108,108,108,108,216,216,216,216,108,108,108,108,216,216,108,108,108,108,216,216,108,108,108,108,216,80,80,80,216,216,216,108,108,108,108,108,108,216,216,216,216,324,324,216,864,432,324,108,216,216,216,216,432,324,108,216,216,216,216,432,324,108,216,216,216,216,432,160,160,160,432,432,432,324,108,216,216,216,216,432,324,108,216,216,216,216,432,324,108,216,216,216,216,432,160,160,160,432,432,432,432,432,432,216,108,108,216,216,864,216,216,432,432,432,432,216,216,864,432,432,432,432,216,108,108,216,216,432,216,216,216,432,216,432,432,1296,216,216,324,324,216,648,216,216,216,216,216,432,216,216,324,324,216,648,216,216,216,216,216,432,216,216,324,324,216,648,216,216,216,216,216,432,216,216,432,432,432,432,216,216,216,216,432,216,216,324,324,216,648,216,216,216,216,216,432,216,216,324,324,216,648,216,216,216,216,216,432,216,216,324,324,216,648,216,216,216,216,216,432,216,216,432,432,432,432,216,216,216,216,864,24,24,12,12,12,12,24,24,12,12,12,12,24,24,12,12,12,12,24,0,0,0,24,24,24,24,12,12,12,12,24,24,12,12,12,12,24,24,24,24,12,12,12,12,24,24,24,24,12,12,12,12,24,24,12,12,12,12,24,24,12,12,12,12,24,0,0,0,24,24,24,12,12,12,12,12,12,24,24,24,24,36,36,24,96,48,36,12,24,24,24,24,48,36,12,24,24,24,24,48,36,12,24,24,24,24,48,0,0,0,48,48,48,36,12,24,24,24,24,48,36,12,24,24,24,24,48,36,12,24,24,24,24,48,0,0,0,48,48,48,48,48,48,24,12,12,24,24,96,24,24,48,48,48,48,24,24,96,48,48,48,48,24,12,12,24,24,48,24,24,24,48,24,48,48,144,24,24,36,36,24,72,24,24,24,24,24,48,24,24,36,36,24,72,24,24,24,24,24,48,24,24,36,36,24,72,24,24,24,24,24,48,24,24,48,48,48,48,24,24,24,24,48,24,24,36,36,24,72,24,24,24,24,24,48,24,24,36,36,24,72,24,24,24,24,24,48,24,24,36,36,24,72,24,24,24,24,24,48,24,24,48,48,48,48,24,24,24,24,1};

void setup() {
  pinMode(buzzer, OUTPUT);
  pinMode(play, INPUT_PULLUP);  
}

void loop() {
  // change x in play_music(x),x is an array which is the music
  //改变play_music(x)中的变量x,x是上面的音乐数组
  play_music(sakura);
  delay(100);
}

void play_music(int music[]) {
  int n = music[0];
  for (int i = 1; i < n + 1; i++) {
    if (digitalRead(play) == LOW ){
      play_state = (play_state+1)%2;
      delay(500);
    }
    //if (digitalRead(next) == LOW ){break;}
    if (play_state == 0){
      delay(50);
      i=i-1;
    }
    else{
      tone(buzzer, music[i]);
      delay(music[i+n]);
      noTone(buzzer);
      delay(music[i+n+n]);
    }
  }
}
